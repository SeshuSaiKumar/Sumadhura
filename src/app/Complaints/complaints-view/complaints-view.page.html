<ion-header>
  <ion-toolbar class="gradient-header">
    <div class="dh">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="customer-care"></ion-back-button>
    </ion-buttons>
    <ion-title>
      Ticket : {{details.ticketId}}
    </ion-title>
    </div>
    <div class="details-btn-row">
    <ion-button expand="block" class="details-btn" shape="round" (click)="showModal = true" >
      View Ticket Details
      <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
    </ion-button>
  </div>
  </ion-toolbar>
</ion-header>
  
<ion-content class="chat-content">
 <ion-modal [isOpen]="showModal" (willDismiss)="showModal = false" cssClass="ticket-details-modal">
  <ng-template>
    <ion-content>
    <div class="ticket-card">
      <div class="ticket-label">Assigned Employee</div>
      <div class="ticket-value">{{ assignedVal }}</div>
      <div class="ticket-label">Ticket Type</div>
      <div class="ticket-value">{{ present_title }}</div>
      <div class="ticket-label">Re-Open Option Ends On</div>
      <div class="ticket-value highlight">{{ re_open_date | date :'dd/MM/y' }}</div>
    </div>
    <!-- <ion-button expand="block" (click)="showModal = false" color="light">Close</ion-button> -->
    </ion-content>
    </ng-template>
  </ion-modal>


  <div class="ppmb20 ppmt2">

  <!-- Chat bubbles -->

  <!-- Crm employee to customer. -->

  <ng-container  *ngFor="let data of chatresponse">
    <div class="chat-bubble left" *ngIf="data.fromType == '8' && data.toType == '7'">
    <span class="bubble-text"   [innerHTML]="data.message">
    </span>
    <span class="bubble-time">{{data.commentsDate| date :'dd/MM/y'}}</span>
  </div>

    <!-- Employee to department -->

    <div class="chat-bubble left" *ngIf="data.fromType == '8' && data.toType == '9'">
    <span class="bubble-text"   [innerHTML]="data.message">
    </span>
    <span class="bubble-time">{{data.commentsDate| date :'dd/MM/y'}}</span>
  </div>

    <!-- Employee to employee -->

    <div class="chat-bubble left" *ngIf="data.fromType == '8' && data.toType == '8'">
    <span class="bubble-text"   [innerHTML]="data.message">
    </span>
    <span class="bubble-time">{{data.commentsDate| date :'dd/MM/y'}}</span>
    </div>


    <!-- customer chat-->

    <div class="chat-bubble right green" *ngIf="data.fromType == '7'">
      <!-- <img class="bubble-img" src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308" /> -->
<img 
  class="bubble-img"
  *ngIf="campdfImgs?.length > 0"
  [src]="getImageSource(campdfImgs[0].url, campdfImgs[0].extension)" 
  (click)="myimage(campdfImgs[0].url)"
/>




      <span class="bubble-text"  [innerHTML]="data.message">
      </span>
      <span class="bubble-time">{{data.commentsDate| date :'dd/MM/y'}}</span>
    </div>

    <!-- System reply to customer-->

    <div class="chat-bubble system" *ngIf="data.fromType == '6' && data.toType == '7'">
      <span class="bubble-text" [innerHTML]="data.message">
      </span>
      <span class="bubble-tag">System Generated</span>
      <span class="bubble-time">08:19 AM</span>
    </div>
  </ng-container>
</div>

  <!-- Action buttons -->
  <div class="actions-row">
    <ion-button class="reopen-btn" shape="round">Ticket Re - Open</ion-button>
    <ion-button fill="clear" class="refresh-btn" size="small">
                    <img src="assets/imgs/dashboard_new/refresh-cw.png" > 
    </ion-button>
    <ion-button fill="clear" class="edit-btn" size="small">
                    <img src="assets/imgs/dashboard_new/Path.png" > 

    </ion-button>
  </div>
</ion-content>
  <!-- Message Input -->
   <ion-footer class="chat-footer">
  <div class="chat-input-row">
    <div lines="none" class="chat-input dh dv dc">
              <img src="assets/imgs/dashboard_new/Path.png" class="ppmr3 wdth5 ppml3 hght6 "> 

      <ion-textarea 
        placeholder="Write a message" 
        style="--padding-start: 10px; --background: #d0d0d0; --border-radius: 16px; --padding-end: 22px; width: 80%; position: relative; left: 1%; max-height: calc(5 * 1.5em); overflow-y: auto;" 
        fill="outline" 
        id="create-textarea" 
        autocomplete="on" 
        autocorrect="on" 
        spellcheck="true"
        autocapitalize="sentences"
        auto-grow
        rows="1"
      ></ion-textarea>


      <ion-button class="send-btn" fill="none" class="ppml0 " >
        <img class="wdth11" src="assets/imgs/dashboard_new/Button.png">
      </ion-button>
    </div>
  </div>
  </ion-footer>
